{% extends "base.html" %}

{% block title %}Управление пользователями{% endblock %}

{% block content %}
<h2 class="mb-4">Управление пользователями</h2>

<form method="POST" action="{{ url_for('delete_selected_users') }}">
    <table class="table table-striped table-hover align-middle">
        <thead class="table-dark">
            <tr>
                <th scope="col"><input type="checkbox" id="select-all" onclick="toggleAll(this)"></th>
                <th scope="col">ID</th>
                <th scope="col">Имя пользователя</th>
                <th scope="col">Email</th>
                <th scope="col">Роль</th>
                <th scope="col">Действия</th>
            </tr>
        </thead>
        <tbody>
        {% for user in users %}
            <tr>
                <td><input type="checkbox" name="user_ids" value="{{ user.id }}"></td>
                <td>{{ user.id }}</td>
                <td>{{ user.username }}</td>
                <td>{{ user.email }}</td>
                <td>{{ user.role }}</td>
                <td>
                    <a href="{{ url_for('edit_user', user_id=user.id) }}" class="btn btn-sm btn-outline-primary">
                        ✏️
                    </a>
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    <button type="submit" class="btn btn-danger mt-2" onclick="return confirm('Удалить выбранных пользователей?')">Удалить выбранных</button>
</form>

<hr class="my-4">
<h4>Добавить нового пользователя</h4>

<form method="POST" action="{{ url_for('create_user') }}">
    <div class="row">
        <div class="col-md-3 mb-2">
            <input type="text" name="username" class="form-control" placeholder="Имя пользователя" required>
        </div>
        <div class="col-md-3 mb-2">
            <input type="email" name="email" class="form-control" placeholder="Email" required>
        </div>
        <div class="col-md-2 mb-2">
            <select name="role" class="form-select" required>
                <option value="user">user</option>
                <option value="admin">admin</option>
                <option value="client">client</option>
            </select>
        </div>
        <div class="col-md-2 mb-2">
            <input type="password" name="password" class="form-control" placeholder="Пароль" required>
        </div>
        <div class="col-md-2 mb-2">
            <button type="submit" class="btn btn-primary w-100">Добавить</button>
        </div>
    </div>
</form>

<script>
    function toggleAll(source) {
        checkboxes = document.getElementsByName('user_ids');
        for (var i = 0; i < checkboxes.length; i++) {
            checkboxes[i].checked = source.checked;
        }
    }
</script>
{% endblock %}
